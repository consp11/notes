https://interface31.ru/tech_it/2022/04/linux-nachinayushhim-chto-takoe-prostranstva-podkachki-i-kak-oni-rabotayut.html


Создание swap-файла
# bs можно использовать и 1М, например или 1G
sudo dd if=/dev/zero of=/Arcs/swapfile bs=1024 count=1048576
# или dd if=/dev/zero of=/Arcs/swapfile count=1GB iflag=count_bytes
# или sudo fallocate -l 1G /Arcs/swapfile
sudo chmod 0600 /Arcs/swapfile
sudo mkswap /Arcs/swapfile
sudo swapon /Arcs/swapfile

# Если нужно создать раздел подкачки, то это делается без создания файла
# То есть просто mkswap на разделе вызывается

# Отключить все файлы подкачки
swapoff -av
# Включить все файлы подкачки
swapon -a

/etc/fstab
/Arcs/swapfile none swap sw 0 0
# /Arcs/swapfile - имя swap-файла или раздела


# Посмотреть настройки агрессивность подкачки (200% - самое агрессивное; 0 - означает, что выгрузка будет проводится только тогда, когда места в ОЗУ не останется; по умолчанию - 60)
cat /proc/sys/vm/swappiness

Смысл настройки состоит в том, что сумма времени доступа к жётскому диску и к файлу подкачки в сумме составляет 200%. d+s=100%. swappiness==100 означает, что файл подкачки также быстр, как и диск. А значит, система может как выгрузить на диск данные из оперативной памяти, так и выгрузить дисковый кеш - и это займёт одинаковое время при попытке доступа к данным на диске. При меньших значениях swappiness система будет выгружать сначала дисковый кеш, а потом уже память в файл подкачки (т.к. файл подкачки будет настроен так, как будто работает медленнее). При значении 200% система будет пытаться вытеснить сначала оперативную память, а потом уже дисковый кеш.

# Задать настройки агрессивности подкачки
В файл /etc/sysctl.conf внести
vm.swappiness=10
# Задать прямо сейчас до перезагрузки
sudo sysctl vm.swappiness=10


# Кеширование информации файловой системы в памяти
# Более активное освобождение информации из кеша - значения более 100.
cat /proc/sys/vm/vfs_cache_pressure

sudo sysctl vm.vfs_cache_pressure=1000
sudo xed /etc/sysctl.conf
vm.vfs_cache_pressure=1000
# По умолчанию - 100. Можно вносить и 1000, например.
# Также можно сохранить настройки в пользовательском файле в директории /etc/sysctl.d

# См. также команду slabtop
